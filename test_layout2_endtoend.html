<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Layout 2 End-to-End Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            text-align: center;
        }
        h1 {
            font-size: 2.5rem;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        .test-flow {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 40px 0;
        }
        .test-step {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .test-step:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .step-number {
            background: #4CAF50;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            font-weight: bold;
            margin: 0 auto 20px;
        }
        .step-title {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 15px;
        }
        .step-desc {
            font-size: 1rem;
            opacity: 0.9;
            margin-bottom: 20px;
        }
        .test-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            margin: 5px;
        }
        .test-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }
        .status-section {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 15px;
            padding: 25px;
            margin: 40px 0;
            text-align: left;
        }
        .status-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: #4CAF50;
        }
        .status-item {
            display: flex;
            align-items: center;
            margin: 10px 0;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
        }
        .status-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            margin-right: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        .status-success {
            background: #4CAF50;
            color: white;
        }
        .status-warning {
            background: #FF9800;
            color: white;
        }
        .status-info {
            background: #2196F3;
            color: white;
        }
        .debug-console {
            background: #1a1a1a;
            color: #00ff00;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            max-height: 300px;
            overflow-y: auto;
            text-align: left;
        }
        .instructions {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 25px;
            margin: 40px 0;
        }
        .instructions h3 {
            color: #FFD700;
            margin-bottom: 15px;
        }
        .instructions ol {
            text-align: left;
            padding-left: 20px;
        }
        .instructions li {
            margin: 10px 0;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Layout 2 End-to-End Test</h1>

        <div class="instructions">
            <h3>üìã Testing Instructions</h3>
            <ol>
                <li><strong>Step 1:</strong> Open Canvas Layout 2, take 4 photos</li>
                <li><strong>Step 2:</strong> Click "Continue" to save and redirect</li>
                <li><strong>Step 3:</strong> Verify photos appear in Customize page</li>
                <li><strong>Step 4:</strong> Check debug console for detailed logs</li>
            </ol>
        </div>

        <div class="test-flow">
            <div class="test-step">
                <div class="step-number">1</div>
                <div class="step-title">Canvas Layout 2</div>
                <div class="step-desc">Take 4 photos and test save functionality</div>
                <a href="./src/pages/canvasLayout2.php" class="test-btn" target="_blank">Open Canvas</a>
                <button class="test-btn" onclick="simulatePhotos()">Simulate Photos</button>
            </div>

            <div class="test-step">
                <div class="step-number">2</div>
                <div class="step-title">Customize Layout 2</div>
                <div class="step-desc">Verify photos load correctly from sessionStorage</div>
                <a href="./src/pages/customizeLayout2.php" class="test-btn" target="_blank">Open Customize</a>
                <button class="test-btn" onclick="checkCustomizeData()">Check Data</button>
            </div>

            <div class="test-step">
                <div class="step-number">3</div>
                <div class="step-title">Debug Tools</div>
                <div class="step-desc">Advanced debugging and data inspection</div>
                <a href="./debug_layout2_save.html" class="test-btn" target="_blank">Debug Page</a>
                <button class="test-btn" onclick="clearAllData()">Clear Data</button>
            </div>
        </div>

        <div class="status-section">
            <div class="status-title">üîç Current Status</div>
            <div id="statusList">
                <div class="status-item">
                    <div class="status-icon status-info">?</div>
                    <span>Checking system status...</span>
                </div>
            </div>
        </div>

        <div class="debug-console" id="debugConsole">
            <div>üñ•Ô∏è Debug Console - Layout 2 Test</div>
            <div>Initializing tests...</div>
        </div>

        <div class="status-section">
            <div class="status-title">‚úÖ Fix Implementation Summary</div>
            <div class="status-item">
                <div class="status-icon status-success">‚úì</div>
                <span><strong>Modified customizeLayout2.js</strong> - Now reads from sessionStorage first, API fallback</span>
            </div>
            <div class="status-item">
                <div class="status-icon status-success">‚úì</div>
                <span><strong>Bridge Storage Gap</strong> - Canvas saves to sessionStorage, Customize reads from sessionStorage</span>
            </div>
            <div class="status-item">
                <div class="status-icon status-success">‚úì</div>
                <span><strong>Automatic Fallback</strong> - If sessionStorage empty, tries PHP session API</span>
            </div>
            <div class="status-item">
                <div class="status-icon status-success">‚úì</div>
                <span><strong>Error Handling</strong> - Auto-redirect to canvas if no photos found</span>
            </div>
        </div>
    </div>

    <script>
        const debugConsole = document.getElementById('debugConsole');
        const statusList = document.getElementById('statusList');

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const colors = {
                info: '#00ff00',
                success: '#4CAF50', 
                warning: '#FF9800',
                error: '#f44336'
            };
            
            debugConsole.innerHTML += `<div style="color: ${colors[type]}">${timestamp} - ${message}</div>`;
            debugConsole.scrollTop = debugConsole.scrollHeight;
        }

        function updateStatus(items) {
            statusList.innerHTML = '';
            items.forEach(item => {
                const statusItem = document.createElement('div');
                statusItem.className = 'status-item';
                statusItem.innerHTML = `
                    <div class="status-icon status-${item.type}">${item.icon}</div>
                    <span>${item.message}</span>
                `;
                statusList.appendChild(statusItem);
            });
        }

        function checkSystemStatus() {
            log('üîç Checking system status...', 'info');
            const status = [];

            // Check sessionStorage
            const sessionData = sessionStorage.getItem('canvasLayout2_images');
            if (sessionData) {
                try {
                    const images = JSON.parse(sessionData);
                    status.push({
                        type: 'success',
                        icon: '‚úì',
                        message: `sessionStorage: ${images.length} photos found`
                    });
                    log(`‚úÖ sessionStorage: Found ${images.length} photos`, 'success');
                } catch (error) {
                    status.push({
                        type: 'warning',
                        icon: '‚ö†',
                        message: 'sessionStorage: Data corrupted'
                    });
                    log('‚ö†Ô∏è sessionStorage: Data parsing error', 'warning');
                }
            } else {
                status.push({
                    type: 'warning',
                    icon: '‚ö†',
                    message: 'sessionStorage: No photos found'
                });
                log('‚ö†Ô∏è sessionStorage: No canvasLayout2_images found', 'warning');
            }

            // Check localStorage
            const originalImages = Object.keys(localStorage).filter(key => key.startsWith('canvasLayout2_original_'));
            if (originalImages.length > 0) {
                status.push({
                    type: 'success',
                    icon: '‚úì',
                    message: `localStorage: ${originalImages.length} original photos`
                });
                log(`‚úÖ localStorage: Found ${originalImages.length} original photos`, 'success');
            } else {
                status.push({
                    type: 'info',
                    icon: '‚Ñπ',
                    message: 'localStorage: No original photos'
                });
                log('‚ÑπÔ∏è localStorage: No original photos found', 'info');
            }

            updateStatus(status);
        }

        function simulatePhotos() {
            log('üéØ Simulating 4 photos for testing...', 'info');
            
            const mockImages = [];
            for (let i = 1; i <= 4; i++) {
                // Create realistic mock base64 data
                const mockData = `data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/2wBDAAMCAgMCAgMDAwMEAwMEBQgFBQQEBQoHBwYIDAoMDAsKCwsNDhIQDQ4RDgsLEBYQERMUFRUVDA8XGBYUGBIUFRT/2wBDAQMEBAUEBQkFBQkUDQsNFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBT/wAARCABkAGQDASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcYEiEzKRobHBCNHwFSNCUpKiscIkNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6err8vP09fb3+Pn6/9oADAMBAAIRAxEAPwD5/wCKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/mockphoto${i}==`;
                mockImages.push(mockData);
            }
            
            // Save to sessionStorage
            sessionStorage.setItem('canvasLayout2_images', JSON.stringify(mockImages));
            
            // Save originals to localStorage
            mockImages.forEach((img, i) => {
                localStorage.setItem(`canvasLayout2_original_${i}`, img);
            });
            
            log('‚úÖ Simulated photos saved successfully', 'success');
            alert('‚úÖ 4 mock photos created!\n\nNow you can test the customize page.');
            
            // Refresh status
            setTimeout(checkSystemStatus, 500);
        }

        function checkCustomizeData() {
            log('üîç Checking if customize can read the data...', 'info');
            
            // Test the same logic that customize will use
            const sessionData = sessionStorage.getItem('canvasLayout2_images');
            if (sessionData) {
                try {
                    const images = JSON.parse(sessionData);
                    log(`‚úÖ Customize will find ${images.length} photos in sessionStorage`, 'success');
                    alert(`‚úÖ Success!\n\nCustomize will find ${images.length} photos from sessionStorage.`);
                } catch (error) {
                    log('‚ùå Customize will fail to parse sessionStorage data', 'error');
                    alert('‚ùå Error: sessionStorage data is corrupted');
                }
            } else {
                log('‚ö†Ô∏è Customize will fall back to API (PHP session)', 'warning');
                alert('‚ö†Ô∏è No sessionStorage data.\n\nCustomize will try API fallback.');
            }
        }

        function clearAllData() {
            log('üóëÔ∏è Clearing all Layout 2 data...', 'info');
            
            // Clear sessionStorage
            Object.keys(sessionStorage).forEach(key => {
                if (key.includes('canvasLayout2')) {
                    sessionStorage.removeItem(key);
                }
            });
            
            // Clear localStorage  
            Object.keys(localStorage).forEach(key => {
                if (key.includes('canvasLayout2')) {
                    localStorage.removeItem(key);
                }
            });
            
            log('‚úÖ All data cleared', 'success');
            alert('üóëÔ∏è All Layout 2 data cleared!');
            
            // Refresh status
            setTimeout(checkSystemStatus, 500);
        }

        // Auto-run checks
        window.addEventListener('load', () => {
            log('üöÄ Layout 2 End-to-End Test initialized', 'info');
            log('üîß Modified customizeLayout2.js to read from sessionStorage', 'success');
            checkSystemStatus();
        });

        // Refresh status every 10 seconds
        setInterval(checkSystemStatus, 10000);
    </script>
</body>
</html>
