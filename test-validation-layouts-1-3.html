<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>✅ Test Enhanced Email Validation - Layout 1-3</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f9f9f9;
        }

        .layout-card {
            margin: 15px 0;
            padding: 15px;
            border: 2px solid #007bff;
            border-radius: 8px;
            background: white;
        }

        .email-input {
            width: 70%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin: 5px;
        }

        .test-btn {
            background: #007bff;
            color: white;
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 2px;
        }

        .test-btn:hover {
            background: #0056b3;
        }

        .success {
            background: #d4edda;
            color: #155724;
            padding: 10px;
            border-radius: 5px;
            margin: 5px 0;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 10px;
            border-radius: 5px;
            margin: 5px 0;
        }

        .warning {
            background: #fff3cd;
            color: #856404;
            padding: 10px;
            border-radius: 5px;
            margin: 5px 0;
        }

        .status {
            font-weight: bold;
            padding: 5px 10px;
            border-radius: 3px;
        }

        .status.loaded {
            background: #d4edda;
            color: #155724;
        }

        .status.not-loaded {
            background: #f8d7da;
            color: #721c24;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>🧪 Test Enhanced Email Validation</h1>
        <h2>Layout 1, 2, 3 - EmailJS Helper Integration</h2>

        <div class="test-section">
            <h3>📊 Status EmailJS Helper</h3>
            <div id="helperStatus">Checking...</div>
        </div>

        <div class="test-section">
            <h3>🧪 Test Email Validation Functions</h3>

            <div class="layout-card">
                <h4>📧 Test Normal Email</h4>
                <input type="email" class="email-input" id="normalEmail" placeholder="user@gmail.com"
                    value="user@gmail.com">
                <button class="test-btn" onclick="testValidation('normalEmail', 'normalResult')">Test Normal</button>
                <div id="normalResult"></div>
            </div>

            <div class="layout-card">
                <h4>🔧 Test Typo Detection</h4>
                <input type="email" class="email-input" id="typoEmail" placeholder="user@gmial.com"
                    value="user@gmial.com">
                <button class="test-btn" onclick="testValidation('typoEmail', 'typoResult')">Test Typo</button>
                <div id="typoResult"></div>
            </div>

            <div class="layout-card">
                <h4>🇮🇩 Test Indonesian Domain</h4>
                <input type="email" class="email-input" id="idEmail" placeholder="student@ui.ac.id"
                    value="student@ui.ac.id">
                <button class="test-btn" onclick="testValidation('idEmail', 'idResult')">Test Indonesian</button>
                <div id="idResult"></div>
            </div>

            <div class="layout-card">
                <h4>❌ Test Invalid Email</h4>
                <input type="email" class="email-input" id="invalidEmail" placeholder="invalid.email"
                    value="invalid.email">
                <button class="test-btn" onclick="testValidation('invalidEmail', 'invalidResult')">Test Invalid</button>
                <div id="invalidResult"></div>
            </div>
        </div>

        <div class="test-section">
            <h3>🎯 Quick Test Buttons</h3>
            <button class="test-btn" onclick="runAllTests()">🚀 Run All Tests</button>
            <button class="test-btn" onclick="testTypoSuggestions()">💡 Test Auto-Suggestions</button>
            <button class="test-btn" onclick="clearResults()">🧹 Clear Results</button>
        </div>

        <div class="test-section">
            <h3>📋 Test Results Summary</h3>
            <div id="testSummary"></div>
        </div>
    </div>

    <!-- Include EmailJS Helper -->
    <script src="src/assets/js/emailjs-helper.js"></script>

    <script>
        let testResults = [];

        // Check EmailJS Helper status on load
        document.addEventListener('DOMContentLoaded', function () {
            checkHelperStatus();
        });

        function checkHelperStatus() {
            const statusDiv = document.getElementById('helperStatus');

            if (typeof window.emailJSHelper !== 'undefined') {
                statusDiv.innerHTML = '<span class="status loaded">✅ EmailJS Helper LOADED</span>';
                console.log('✅ EmailJS Helper detected and ready');

                // Initialize the helper
                try {
                    window.emailJSHelper.init('9SDzOfKjxuULQ5ZW8');
                    statusDiv.innerHTML += '<br><span class="status loaded">✅ EmailJS Helper INITIALIZED</span>';
                } catch (error) {
                    statusDiv.innerHTML += '<br><span class="status not-loaded">❌ EmailJS Helper INIT FAILED</span>';
                }
            } else {
                statusDiv.innerHTML = '<span class="status not-loaded">❌ EmailJS Helper NOT LOADED</span>';
                console.error('❌ EmailJS Helper not found');
            }
        }

        // Copy enhanced validateEmail function dari customizeLayout1.js
        function validateEmail(email) {
            // Enhanced validation using EmailJS Helper if available
            if (typeof window.emailJSHelper !== 'undefined') {
                const validation = window.emailJSHelper.validateEmail(email);

                // Show suggestions for common typos
                if (!validation.isValid && validation.suggestions.length > 0) {
                    const suggestion = validation.suggestions[0];
                    return {
                        isValid: false,
                        error: validation.error,
                        suggestion: suggestion,
                        type: 'typo'
                    };
                }

                if (!validation.isValid) {
                    return {
                        isValid: false,
                        error: validation.error,
                        type: 'invalid'
                    };
                }

                return {
                    isValid: true,
                    emailType: validation.emailType,
                    type: 'valid'
                };
            }

            // Fallback to basic validation
            const isValid = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
            return {
                isValid: isValid,
                error: isValid ? null : 'Format email tidak valid',
                type: isValid ? 'valid-basic' : 'invalid-basic'
            };
        }

        function testValidation(inputId, resultId) {
            const input = document.getElementById(inputId);
            const resultDiv = document.getElementById(resultId);
            const email = input.value.trim();

            if (!email) {
                resultDiv.innerHTML = '<div class="warning">⚠️ Masukkan email terlebih dahulu</div>';
                return;
            }

            console.log(`🧪 Testing email: ${email}`);
            const result = validateEmail(email);

            let html = `<strong>📧 Email:</strong> ${email}<br>`;

            if (result.isValid) {
                html += `<div class="success">✅ <strong>VALID</strong></div>`;
                if (result.emailType) {
                    html += `<div class="success">🏷️ Type: ${result.emailType}</div>`;
                }
            } else {
                html += `<div class="error">❌ <strong>INVALID</strong></div>`;
                html += `<div class="error">📝 Error: ${result.error}</div>`;
                if (result.suggestion) {
                    html += `<div class="warning">💡 Suggestion: ${result.suggestion}</div>`;
                }
            }

            html += `<div style="margin-top: 10px; font-size: 0.9em; color: #666;">Detection: ${result.type}</div>`;

            resultDiv.innerHTML = html;

            // Add to test results
            testResults.push({
                email: email,
                isValid: result.isValid,
                type: result.type,
                error: result.error,
                suggestion: result.suggestion
            });

            updateTestSummary();
        }

        function runAllTests() {
            testValidation('normalEmail', 'normalResult');
            testValidation('typoEmail', 'typoResult');
            testValidation('idEmail', 'idResult');
            testValidation('invalidEmail', 'invalidResult');
        }

        function testTypoSuggestions() {
            const typos = [
                'user@gmial.com',
                'test@yahooo.com',
                'admin@hotmial.com',
                'contact@outlok.com'
            ];

            let html = '<h4>🔧 Auto-Suggestion Test Results:</h4>';

            typos.forEach(email => {
                const result = validateEmail(email);
                if (result.suggestion) {
                    html += `<div class="warning">📧 ${email} → 💡 ${result.suggestion}</div>`;
                } else {
                    html += `<div class="error">📧 ${email} → ❌ No suggestion</div>`;
                }
            });

            document.getElementById('testSummary').innerHTML = html;
        }

        function clearResults() {
            const resultDivs = ['normalResult', 'typoResult', 'idResult', 'invalidResult', 'testSummary'];
            resultDivs.forEach(id => {
                const div = document.getElementById(id);
                if (div) div.innerHTML = '';
            });
            testResults = [];
        }

        function updateTestSummary() {
            const summaryDiv = document.getElementById('testSummary');
            const totalTests = testResults.length;
            const validEmails = testResults.filter(r => r.isValid).length;
            const invalidEmails = testResults.filter(r => !r.isValid).length;
            const typoDetections = testResults.filter(r => r.suggestion).length;

            const html = `
                <h4>📊 Test Summary (${totalTests} tests)</h4>
                <div class="success">✅ Valid emails: ${validEmails}</div>
                <div class="error">❌ Invalid emails: ${invalidEmails}</div>
                <div class="warning">🔧 Typo detections: ${typoDetections}</div>
                <div style="margin-top: 10px; font-size: 0.9em;">
                    Enhanced validation: ${typeof window.emailJSHelper !== 'undefined' ? '✅ Active' : '❌ Inactive'}
                </div>
            `;

            summaryDiv.innerHTML = html;
        }
    </script>
</body>

</html>